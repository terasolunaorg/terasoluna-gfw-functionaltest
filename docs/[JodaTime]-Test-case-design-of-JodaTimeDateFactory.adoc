= terasoluna-gfw-jodatime/JodaTimeDateFactory

org.terasoluna.gfw.common.date.jodatimeパッケージのテスト

== JodaTimeDateFactoryテスト

テストケースクラス:`org.terasoluna.gfw.functionaltest.app.date.DateTest`

=== 1. システム時刻（サーバ時刻）を返却の場合

[cols="5,5,30,20,20", options="header"]
|===
| 項番
| 観点
| 試験項目
| 試験条件
| 確認内容

| 1.1
| 20X系
a| システム時刻の取得テスト
``org.joda.time.DateTime`` 型
a| * 1.java.util.Date()で時刻を取得
* 2.newDateTime()で時刻を取得
* 3.java.util.Date()で時刻を取得
a| * 2で取得した時刻が1よりも後で3よりも前であること。
* 2の型が ``org.joda.time.DateTime`` であること。

| 1.2
| 20X系
a| システム時刻の取得テスト
``java.sql.Timestamp`` 型
a| * 1.java.util.Date()で時刻を取得
* 2.newTimestamp()で時刻を取得
* 3.java.util.Date()で時刻を取得
a| * 2で取得した時刻が1よりも後で3よりも前であること。
* 2の型が ``java.sql.Timestamp`` であること。

| 1.3
| 20X系
a| システム時刻の取得テスト
``java.util.Date`` 型
a| * 1.java.util.Date()で時刻を取得
* 2.newDate()で時刻を取得
* 3.java.util.Date()で時刻を取得
a| * 2で取得した時刻が1よりも後で3よりも前であること。
* 2の型が ``java.util.Date`` であること。

| 1.4
| 20X系
a| システム時刻の取得テスト
``java.sql.Date`` 型
a| * 1.java.util.Date()で時刻を取得
* 2.newSqlDate()で時刻を取得
* 3.java.util.Date()で時刻を取得
a| * 2で取得した時刻が1よりも後で3よりも前であること。
* 2の型が ``java.sql.Date`` であること。

| 1.5
| 20X系
a| システム時刻の取得テスト
``java.sql.Time`` 型
a| * 1.java.util.Date()で時刻を取得
* 2.newTime()で時刻を取得
* 3.java.util.Date()で時刻を取得
a| * 2で取得した時刻が1よりも後で3よりも前であること。
* 2の型が ``java.sql.Time`` であること。

|===

=== 2. DBから固定の時刻を取得する場合

[cols="5,5,30,20,20", options="header"]
|===
| 項番
| 観点
| 試験項目
| 試験条件
| 確認内容

| 2.1
| 20X系
a| DBからシステム時刻の取得テスト
``org.joda.time.DateTime`` 型
a| * newDateTime()を使用
* 指定したSQLで取得するデータに "2013-01-01 01:01:01" を設定
* currentTimestampQuery="SELECT now FROM system_date" を設定
a| * ``org.joda.time.DateTime`` 型の指定時刻が取得されていること

| 2.2
| 20X系
a| DBからシステム時刻の取得テスト
``java.sql.Timestamp`` 型
a| * newTimestamp()を使用
* 指定したSQLで取得するデータに "2013-01-01 01:01:01" を設定
* currentTimestampQuery="SELECT now FROM system_date" を設定
a| * ``java.sql.Timestamp`` 型の指定時刻が取得されていること

| 2.3
| 20X系
a| DBからシステム時刻の取得テスト
``java.util.Date`` 型
a| * newDate()を使用
* 指定したSQLで取得するデータに "2013-01-01 01:01:01" を設定
* currentTimestampQuery="SELECT now FROM system_date" を設定
a| * ``java.util.Date`` 型の指定時刻が取得されていること

| 2.4
| 20X系
a| DBからシステム時刻の取得テスト
``java.sql.Date`` 型
a| * newSqlDate()を使用
* 指定したSQLで取得するデータに "2013-01-01 01:01:01" を設定
* currentTimestampQuery="SELECT now FROM system_date" を設定
a| * ``java.sql.Date`` 型の指定時刻が取得されていること

| 2.5
| 20X系
a| DBからシステム時刻の取得テスト
``java.sql.Time`` 型
a| * newTime()を使用
* 指定したSQLで取得するデータに "2013-01-01 01:01:01" を設定
* currentTimestampQuery="SELECT now FROM system_date" を設定
a| * ``java.sql.Time`` 型の指定時刻が取得されていること

| 2.6
| 50X系
| DBエラーの場合のテスト
a| * 取得データが存在しないこと(currentTimestampQuery="SELECT now FROM system_date" を設定)
a| * DBエラー時のエラー画面に遷移すること

|===

=== 3. サーバ時刻とDBに指定した秒数の差分時刻を取得する場合

[cols="5,5,30,20,20", options="header"]
|===
| 項番
| 観点
| 試験項目
| 試験条件
| 確認内容

| 3.1
| 20X系
a| 差分ミリ秒を計算した日時の取得テスト
``org.joda.time.DateTime`` 型を取得
a| * adjustedValueQuery = SELECT diff FROM operation_date
* DBのカラムの値に、"-86400000"　を指定
* 1.java.util.Date()で時刻を取得
* 2.newDateTime()で時刻を取得
* 3.java.util.Date()で時刻を取得
a| * 2で取得した時刻に1日分時刻を足し、1よりも後で3よりも前であること。
* 2の型が ``org.joda.time.DateTime`` であること。

| 3.2
| 20X系
a| 差分ミリ秒を計算した日時の取得テスト
``java.sql.Timestamp`` 型
a| * adjustedValueQuery = SELECT diff FROM operation_date
* DBのカラムの値に、"-86400000"　を指定
* 1.java.util.Date()で時刻を取得
* 2.newTimestamp()で時刻を取得
* 3.java.util.Date()で時刻を取得
a| * 2で取得した時刻に1日分時刻を足し、1よりも後で3よりも前であること。
* 2の型が ``java.sql.Timestamp`` であること。

| 3.3
| 20X系
a| 差分ミリ秒を計算した日時の取得テスト
``java.util.Date`` 型
a| * adjustedValueQuery = SELECT diff FROM operation_date
* DBのカラムの値に、"-86400000" を指定
* 1.java.util.Date()で時刻を取得
* 2.newDate()で時刻を取得
* 3.java.util.Date()で時刻を取得
a| * 2で取得した時刻に1日分時刻を足し、1よりも後で3よりも前であること。
* 2の型が ``java.util.Date`` であること。

| 3.4
| 20X系
a| 差分ミリ秒を計算した日時の取得テスト
``java.sql.Date`` 型
a| * adjustedValueQuery = SELECT diff FROM operation_date
* DBのカラムの値に、"-86400000" を指定
* 1.java.util.Date()で時刻を取得
* 2.newSqlDate()で時刻を取得
* 3.java.util.Date()で時刻を取得
a| * 2で取得した時刻に1日分時刻を足し、1よりも後で3よりも前であること。
* 2の型が ``java.sql.Date`` であること。

| 3.5
| 20X系
a| 差分ミリ秒を計算した日時の取得テスト
``java.sql.Time`` 型
a| * adjustedValueQuery = SELECT diff FROM operation_date
* DBのカラムの値に、"-3600000" を指定
* 1.java.util.Date()で時刻を取得
* 2.newTime()で時刻を取得
* 3.java.util.Date()で時刻を取得
a| * 2で取得した時刻に1時間分時刻を足し、1よりも後で3よりも前であること。
* 2の型が ``java.sql.Time`` であること。

| 3.6
| 20X系
a| 差分秒を計算した日時の取得テスト
``org.joda.time.DateTime`` 型を取得
a| * adjustedValueQuery = "SELECT diff * 1000 FROM operation_date"
* DBのカラムの値に、"-86400" を指定
* 1.java.util.Date()で時刻を取得
* 2.newDateTime()で時刻を取得
* 3.java.util.Date()で時刻を取得
a| * 2で取得した時刻に1日分時刻を足し、1よりも後で3よりも前であること。
* 2の型が ``org.joda.time.DateTime`` であること。

| 3.7
| 20X系
a| 差分分を計算した日時の取得テスト
``org.joda.time.DateTime`` 型を取得
a| * adjustedValueQuery = "SELECT diff * 60 * 1000 FROM operation_date"
* DBのカラムの値に、"1440" を指定
* 1.java.util.Date()で時刻を取得
* 2.newDateTime()で時刻を取得
* 3.java.util.Date()で時刻を取得
a| * 2で取得した時刻に1日分時刻を足し、1よりも後で3よりも前であること。
* 2の型が ``org.joda.time.DateTime`` であること。

| 3.8
| 20X系
a| 差分時間を計算した日時の取得テスト
``org.joda.time.DateTime`` 型を取得
a| * adjustedValueQuery = "SELECT diff * 60 * 60 * 1000 FROM operation_date"
* DBのカラムの値に、"-24" を指定
* 1.java.util.Date()で時刻を取得
* 2.newDateTime()で時刻を取得
* 3.java.util.Date()で時刻を取得
a| * 2で取得した時刻に1日分時刻を足し、1よりも後で3よりも前であること。
* 2の型が ``org.joda.time.DateTime`` であること。

| 3.9
| 20X系
a| 差分日を計算した日時の取得テスト
``org.joda.time.DateTime`` 型を取得
a| * adjustedValueQuery = "SELECT diff * 24 * 60 * 60 * 1000 FROM operation_date"
* DBのカラムの値に、"1" を指定
* 1.java.util.Date()で時刻を取得
* 2.newDateTime()で時刻を取得
* 3.java.util.Date()で時刻を取得
a| * 2で取得した時刻に1日分時刻を足し、1よりも後で3よりも前であること。
* 2の型が ``org.joda.time.DateTime`` であること.

| 3.10
| 20X系
a| DB値をリロードするテスト
``org.joda.time.DateTime`` 型を取得
a| * newDateTimeを使用
* adjustedValueQuery = "SELECT diff * 24 * 60 * 60 * 1000 FROM operation_date"
* DBのカラムの値に、"1" を指定
* 1.java.util.Date()で時刻を取得
* 2.newDateTime()で時刻を取得
* 3.java.util.Date()で時刻を取得
* DBのカラムの値に、"2" を指定後Reload
* 4.java.util.Date()で時刻を取得
* 5.newDateTime()で時刻を取得
* 6.java.util.Date()で時刻を取得
a| * 2で取得した時刻に1日分時刻を足し、1よりも後で3よりも前であること。
* 5で取得した時刻に2日分時刻を足し、4よりも後で6よりも前であること。
* 2、5の型が``org.joda.time.DateTime`` 型の時刻が取得されていること

| 3.11
| 20X系
a| キャッシュ値を使用せず、リクエスト毎に取得するテスト
``org.joda.time.DateTime`` 型を取得
a| * newDateTimeを使用
* adjustedValueQuery = "SELECT diff * 24 * 60 * 60 * 1000 FROM operation_date"
* DBのカラムの値に、"1"、"3"、"0" を指定
* useCache=false を指定
* DBのカラムの値に、"1" を指定
* 1.java.util.Date()で時刻を取得
* 2.newDateTime()で時刻を取得
* 3.java.util.Date()で時刻を取得
* DBのカラムの値に、"3" を指定
* 4.java.util.Date()で時刻を取得
* 5.newDateTime()で時刻を取得
* 6.java.util.Date()で時刻を取得
* DBのカラムの値に、"0" を指定
* 7.java.util.Date()で時刻を取得
* 8.newDateTime()で時刻を取得
* 9.java.util.Date()で時刻を取得
a| * 2で取得した時刻に1日分時刻を足し、1よりも後で3よりも前であること。
* 5で取得した時刻に3日分時刻を足し、4よりも後で6よりも前であること。
* 8で取得した時刻が、7よりも後で9よりも前であること。
* 2、5、8の型が``org.joda.time.DateTime`` 型の時刻が取得されていること

| 3.12
| 50X系
| DBエラーの場合のテスト
a| * 取得データが存在しないこと(adjustedValueQuery = "SELECT diff * 24 * 60 * 60 * 1000 FROM operation_date")
a| * DBエラー時のエラー画面に遷移すること

|===
